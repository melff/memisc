<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Add Alternative Variance Estimates to Models Estimates — withSE • memisc</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Add Alternative Variance Estimates to Models Estimates — withSE"><meta name="description" content="A simple object-orientation infrastructure to add alternative standard
  errors, e.g. sandwich estimates or New-West standard errors to
  fitted regression-type models, such as fitted by lm() or glm()."><meta property="og:description" content="A simple object-orientation infrastructure to add alternative standard
  errors, e.g. sandwich estimates or New-West standard errors to
  fitted regression-type models, such as fitted by lm() or glm()."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">memisc</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.99.31.8.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Survey items</h6></li>
    <li><a class="dropdown-item" href="../articles/items.html">Handling questionnaire items</a></li>
    <li><a class="dropdown-item" href="../articles/import.html">Importing data from SPSS and Stata</a></li>
    <li><a class="dropdown-item" href="../articles/anes48.html">Analysing the American National Election Study of 1948</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Tables of summary statistics and model estimates</h6></li>
    <li><a class="dropdown-item" href="../articles/gentab.html">Generating Tables of Descriptive Statistics</a></li>
    <li><a class="dropdown-item" href="../articles/ftable-matrix.html">Combining flattened contingency tables (and other tables)</a></li>
    <li><a class="dropdown-item" href="../articles/mtable-html.html">Tables of model estimates</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/melff/memisc/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Add Alternative Variance Estimates to Models Estimates</h1>

      <div class="d-none name"><code>withVCov.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>A simple object-orientation infrastructure to add alternative standard
  errors, e.g. sandwich estimates or New-West standard errors to
  fitted regression-type models, such as fitted by <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">withSE</span><span class="op">(</span><span class="va">object</span>, <span class="va">vcov</span>, <span class="va">...</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu">withVCov</span><span class="op">(</span><span class="va">object</span>, <span class="va">vcov</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'lm'</span></span>
<span><span class="fu">withVCov</span><span class="op">(</span><span class="va">object</span>, <span class="va">vcov</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for class 'withVCov'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span>
<span><span class="co"># S3 method for class 'withVCov.lm'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">object</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <p></p>
<dl><dt id="arg-object">object<a class="anchor" aria-label="anchor" href="#arg-object"></a></dt>
<dd><p>a fitted model object</p></dd>

  <dt id="arg-vcov">vcov<a class="anchor" aria-label="anchor" href="#arg-vcov"></a></dt>
<dd><p>a function that returns a variance matrix estimate, a
    given matrix that is such an estimate, or a character string that
    identifies a function that returns a variance matrix estimate
    (e.g. <code>"HAC"</code> for <code>vcovHAC</code>).</p></dd>

  <dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>further arguments, passed to <code><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov()</a></code> or, respectively,
    to the parent method of <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code></p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>Using <code>withVCov()</code> an alternative variance-covariance matrix is
attributed to a fitted model object. Such a matrix may be produced by
any of the variance estimators provided by the "sandwich" package or
any package that extends it.</p>
<p><code>withVCov()</code> has no consequences on how a fitted model itself is
printed or represented, but it does have consequences what standard
errors are reported, when the function <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> or the function
<code><a href="mtable.html">mtable()</a></code> is applied.</p>
<p><code>withSE()</code> is a convenience front-end to <code>withVCov()</code>. It can
be called in the same way as <code>withVCov</code>, but also allows to specify
the type of variance estimate by a character string that identifies
the function that gives the covariance matrix (e.g. <code>"OPG"</code> for
<code>vcovOPG</code>).</p>
    </div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><code>withVCov</code> returns a slightly modified model object: It adds an
  attribute named ".VCov" that contains the alternate covaraince matrix
  and modifies the class attribute. If e.g. the original model object has class
  "lm" then the model object modified by <code>withVCov</code> has the class
  attribute <code>c("withVCov.lm", "withVCov", "lm")</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">## Generate poisson regression relationship</span></span></span>
<span class="r-in"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html" class="external-link">sin</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">100</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co">## compute usual covariance matrix of coefficient estimates</span></span></span>
<span class="r-in"><span><span class="va">fm</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, family <span class="op">=</span> <span class="va">poisson</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/" class="external-link">sandwich</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">fmo</span> <span class="op">&lt;-</span> <span class="fu">withVCov</span><span class="op">(</span><span class="va">fm</span>,<span class="va">vcovOPG</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              (Intercept)            x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  0.004335095 -0.003369000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -0.003369000  0.007855207</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/stats/vcov.html" class="external-link">vcov</a></span><span class="op">(</span><span class="va">fmo</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              (Intercept)            x</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  0.005044417 -0.003785476</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x           -0.003785476  0.010668796</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fm</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> glm(formula = y ~ x, family = poisson)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  1.02809    0.06584   15.62   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x            0.94781    0.08863   10.69   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for poisson family taken to be 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Null deviance: 226.874  on 99  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual deviance:  93.095  on 98  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 365.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fmo</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Call:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> glm(formula = y ~ x, family = poisson)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             Estimate Std. Error z value Pr(&gt;|z|)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)  1.02809    0.07102  14.475   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> x            0.94781    0.10329   9.176   &lt;2e-16 ***</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Signif. codes:  0 ‘***’ 0.001 ‘**’ 0.01 ‘*’ 0.05 ‘.’ 0.1 ‘ ’ 1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Dispersion parameter for poisson family taken to be 1)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     Null deviance: 226.874  on 99  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Residual deviance:  93.095  on 98  degrees of freedom</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> AIC: 365.05</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Number of Fisher Scoring iterations: 5</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="mtable.html">mtable</a></span><span class="op">(</span>Default<span class="op">=</span><span class="va">fm</span>,</span></span>
<span class="r-in"><span>       OPG<span class="op">=</span><span class="fu">withSE</span><span class="op">(</span><span class="va">fm</span>,<span class="st">"OPG"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       summary.stats<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Deviance"</span>,<span class="st">"N"</span><span class="op">)</span></span></span>
<span class="r-in"><span>       <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calls:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Default: glm(formula = y ~ x, family = poisson)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> OPG: glm(formula = y ~ x, family = poisson)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Default       OPG      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept)    1.028***    1.028***  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 (0.066)     (0.071)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   x              0.948***    0.948***  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 (0.089)     (0.103)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Deviance      93.095      93.095     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   N            100         100         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Significance: *** = p &lt; 0.001;   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 ** = p &lt; 0.01;   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 * = p &lt; 0.05  </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">vo</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://sandwich.R-Forge.R-project.org/reference/vcovOPG.html" class="external-link">vcovOPG</a></span><span class="op">(</span><span class="va">fm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="mtable.html">mtable</a></span><span class="op">(</span>Default<span class="op">=</span><span class="va">fm</span>,</span></span>
<span class="r-in"><span>       OPG<span class="op">=</span><span class="fu">withSE</span><span class="op">(</span><span class="va">fm</span>,<span class="va">vo</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>       summary.stats<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Deviance"</span>,<span class="st">"N"</span><span class="op">)</span></span></span>
<span class="r-in"><span>       <span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Calls:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Default: glm(formula = y ~ x, family = poisson)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> OPG: glm(formula = y ~ x, family = poisson)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 Default       OPG      </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   (Intercept)    1.028***    1.028***  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 (0.066)     (0.071)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   x              0.948***    0.948***  </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 (0.089)     (0.103)    </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ---------------------------------------</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Deviance      93.095      93.095     </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   N            100         100         </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> =======================================</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   Significance: *** = p &lt; 0.001;   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 ** = p &lt; 0.01;   </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 * = p &lt; 0.05  </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Martin Elff.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

